# Modern Web Standards and HTTP/3

> **Relevant source files**
> * [classes/quic/WEB-INF/web.xml](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/classes/quic/WEB-INF/web.xml)
> * [classes/quic/index.html](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/classes/quic/index.html)
> * [src/java/org/ifsoft/orinayo/openfire/Http3BindContentSecurityPolicyFilter.java](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindContentSecurityPolicyFilter.java)
> * [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java)

This page documents the HTTP/3 (QUIC) binding service implementation in the Orin Ayo plugin, which provides modern web protocol support alongside traditional HTTP and HTTPS connectivity. The HTTP/3 service enables cutting-edge web clients to connect using the QUIC transport protocol for improved performance and reliability.

For information about WebRTC media streaming functionality, see [WebRTC Media Streaming](/igniterealtime/openfire-orinayo-plugin/5.2-webrtc-media-streaming). For details about the admin console integration, see [Admin Console Integration](/igniterealtime/openfire-orinayo-plugin/4.1-admin-console-integration).

## HTTP/3 Service Architecture

The HTTP/3 binding service is implemented through the `Http3BindManager` class, which extends Openfire's web service capabilities to support the QUIC protocol. This service runs alongside traditional HTTP and HTTPS connectors, providing protocol negotiation and upgrade capabilities.

### Protocol Stack Integration

```mermaid
flowchart TD

MODERN_BROWSER["Modern Web Browser<br>Chrome, Firefox, Safari"]
LEGACY_BROWSER["Legacy Browser<br>HTTP/1.1, HTTP/2 only"]
H3_MANAGER["Http3BindManager"]
H3_CONNECTOR["QuicServerConnector<br>Port 443"]
H2_CONNECTOR["ServerConnector HTTPS<br>Port 4443"]
H1_CONNECTOR["ServerConnector HTTP<br>Port 4040"]
H3_FACTORY["HTTP3ServerConnectionFactory"]
H2_FACTORY["HTTP2ServerConnectionFactory"]
H1_FACTORY["HttpConnectionFactory"]
ALPN_FACTORY["ALPNServerConnectionFactory"]
CSP_FILTER["Http3BindContentSecurityPolicyFilter"]
ALT_SVC["Alt-Svc: h3=:443\"]
QUIC_DIR["classes/quic/<br>WebAppContext"]
INDEX_HTML["index.html"]

MODERN_BROWSER --> H3_CONNECTOR
LEGACY_BROWSER --> H2_CONNECTOR
LEGACY_BROWSER --> H1_CONNECTOR
H3_CONNECTOR --> H3_FACTORY
H2_CONNECTOR --> ALPN_FACTORY
H1_CONNECTOR --> H1_FACTORY
H2_CONNECTOR --> CSP_FILTER
H1_CONNECTOR --> CSP_FILTER
H3_MANAGER --> QUIC_DIR

subgraph subGraph4 ["Static Content"]
    QUIC_DIR
    INDEX_HTML
    QUIC_DIR --> INDEX_HTML
end

subgraph subGraph3 ["Content Filters"]
    CSP_FILTER
    ALT_SVC
    CSP_FILTER --> ALT_SVC
end

subgraph subGraph2 ["Protocol Handlers"]
    H3_FACTORY
    H2_FACTORY
    H1_FACTORY
    ALPN_FACTORY
    ALPN_FACTORY --> H2_FACTORY
    ALPN_FACTORY --> H1_FACTORY
end

subgraph subGraph1 ["Orin Ayo HTTP/3 Service"]
    H3_MANAGER
    H3_CONNECTOR
    H2_CONNECTOR
    H1_CONNECTOR
    H3_MANAGER --> H3_CONNECTOR
    H3_MANAGER --> H2_CONNECTOR
    H3_MANAGER --> H1_CONNECTOR
end

subgraph subGraph0 ["Client Applications"]
    MODERN_BROWSER
    LEGACY_BROWSER
end
```

Sources: [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L1-L943](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L1-L943)

 [src/java/org/ifsoft/orinayo/openfire/Http3BindContentSecurityPolicyFilter.java L1-L65](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindContentSecurityPolicyFilter.java#L1-L65)

## Http3BindManager Implementation

The `Http3BindManager` class serves as the central orchestrator for HTTP/3 services, managing multiple protocol connectors and their lifecycle.

### Connector Configuration

```mermaid
flowchart TD

START["start()"]
CREATE_CONNECTORS["createConnector()<br>createSSLConnector()<br>createHTTP3Connector()"]
SERVER_CONFIG["Server(QueuedThreadPool)"]
HANDLER_SETUP["handlerList.addHandler()"]
START_SERVER["httpBindServer.start()"]
QUIC_CONFIG["ServerQuicConfiguration"]
SSL_CONTEXT["SslContextFactory.Server"]
CERT_STORE["IdentityStore"]
QUIC_CONNECTOR["QuicServerConnector"]
HTTP_BIND_ENABLED["HTTP_BIND_ENABLED<br>http3bind.enabled"]
HTTP_BIND_SECURE_PORT["HTTP_BIND_SECURE_PORT<br>http3bind.port.secure"]
HTTP_BIND_THREADS["HTTP_BIND_THREADS<br>http3bind.client.processing.threads"]

CREATE_CONNECTORS --> QUIC_CONFIG
HTTP_BIND_ENABLED --> START
HTTP_BIND_SECURE_PORT --> QUIC_CONNECTOR
HTTP_BIND_THREADS --> SERVER_CONFIG

subgraph subGraph2 ["Configuration Properties"]
    HTTP_BIND_ENABLED
    HTTP_BIND_SECURE_PORT
    HTTP_BIND_THREADS
end

subgraph subGraph1 ["HTTP/3 Connector Details"]
    QUIC_CONFIG
    SSL_CONTEXT
    CERT_STORE
    QUIC_CONNECTOR
    QUIC_CONFIG --> SSL_CONTEXT
    SSL_CONTEXT --> CERT_STORE
    CERT_STORE --> QUIC_CONNECTOR
end

subgraph subGraph0 ["Http3BindManager Lifecycle"]
    START
    CREATE_CONNECTORS
    SERVER_CONFIG
    HANDLER_SETUP
    START_SERVER
    START --> CREATE_CONNECTORS
    CREATE_CONNECTORS --> SERVER_CONFIG
    SERVER_CONFIG --> HANDLER_SETUP
    HANDLER_SETUP --> START_SERVER
end
```

Sources: [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L346-L429](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L346-L429)

 [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L540-L569](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L540-L569)

### System Properties Configuration

The HTTP/3 service is configured through a comprehensive set of `SystemProperty` declarations:

| Property Key | Default Value | Purpose |
| --- | --- | --- |
| `http3bind.enabled` | `true` | Enable/disable HTTP/3 binding |
| `http3bind.port.plain` | `8080` | Plain HTTP port |
| `http3bind.port.secure` | `8443` | HTTPS/HTTP/3 port |
| `http3bind.client.processing.threads` | `200` | Maximum thread pool size |
| `http3bind.client.processing.threads-min` | `8` | Minimum thread pool size |
| `http3bind.CORS.enabled` | `true` | Enable CORS support |
| `http3bind.CSP.enabled` | `true` | Enable Content Security Policy |

Sources: [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L74-L282](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L74-L282)

## Content Security Policy and Protocol Negotiation

The `Http3BindContentSecurityPolicyFilter` implements protocol negotiation by adding the `Alt-Svc` header to HTTP responses, informing clients about HTTP/3 availability.

### Filter Implementation Flow

```

```

The filter adds the crucial `Alt-Svc: h3=":443"` header [src/java/org/ifsoft/orinayo/openfire/Http3BindContentSecurityPolicyFilter.java L60](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindContentSecurityPolicyFilter.java#L60-L60)

 which notifies HTTP/1.1 and HTTP/2 clients that the same resource is available via HTTP/3 on port 443.

Sources: [src/java/org/ifsoft/orinayo/openfire/Http3BindContentSecurityPolicyFilter.java L55-L63](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindContentSecurityPolicyFilter.java#L55-L63)

## Static Content Serving

The HTTP/3 service provides static content serving through a dedicated `WebAppContext` that serves files from the `classes/quic` directory.

### Static Content Handler Architecture

```mermaid
flowchart TD

PLUGIN_DIR["pluginDirectory"]
QUIC_DIR["classes/quic/"]
WEB_APP_CONTEXT["WebAppContext"]
INDEX_HTML["index.html"]
WEB_XML["WEB-INF/web.xml"]
CREATE_HANDLER["createStaticContentHandler()"]
DIR_CHECK["quicDirectory.exists()"]
READ_CHECK["quicDirectory.canRead()"]
WELCOME_FILES["setWelcomeFiles(['index.html'])"]

QUIC_DIR --> DIR_CHECK
READ_CHECK --> WEB_APP_CONTEXT
WEB_APP_CONTEXT --> WELCOME_FILES

subgraph subGraph1 ["Handler Configuration"]
    CREATE_HANDLER
    DIR_CHECK
    READ_CHECK
    WELCOME_FILES
    DIR_CHECK --> READ_CHECK
    CREATE_HANDLER --> DIR_CHECK
end

subgraph subGraph0 ["Static Content Infrastructure"]
    PLUGIN_DIR
    QUIC_DIR
    WEB_APP_CONTEXT
    INDEX_HTML
    WEB_XML
    PLUGIN_DIR --> QUIC_DIR
    WEB_APP_CONTEXT --> INDEX_HTML
    QUIC_DIR --> WEB_XML
end
```

The static content handler is configured with security restrictions: `org.eclipse.jetty.servlet.Default.dirAllowed` is set to `false` [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L787](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L787-L787)

 to prevent directory browsing.

Sources: [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L779-L799](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L779-L799)

 [classes/quic/index.html L1](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/classes/quic/index.html#L1-L1)

 [classes/quic/WEB-INF/web.xml L1-L8](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/classes/quic/WEB-INF/web.xml#L1-L8)

## Certificate Management Integration

The HTTP/3 service integrates with Openfire's certificate management system through the `CertificateEventListener` interface, automatically restarting when certificates change.

### Certificate Integration Flow

```mermaid
flowchart TD

H3_BIND_MANAGER["Http3BindManager"]
CERT_LISTENER["CertificateEventListener"]
STORE_CHANGED["storeContentChanged()"]
RESTART_SERVER["restartServer()"]
CERT_MANAGER["CertificateManager"]
IDENTITY_STORE["IdentityStore"]
CONNECTION_TYPE["ConnectionType.BOSH_C2S"]
SSL_CONTEXT_FACTORY["SslContextFactory.Server"]
SERVER_QUIC_CONFIG["ServerQuicConfiguration"]
QUIC_CONNECTOR["QuicServerConnector"]
SECURITY_PATH["resources/security/"]

SSL_CONTEXT_FACTORY --> SERVER_QUIC_CONFIG

subgraph subGraph2 ["QUIC Configuration"]
    SERVER_QUIC_CONFIG
    QUIC_CONNECTOR
    SECURITY_PATH
    SERVER_QUIC_CONFIG --> SECURITY_PATH
    SERVER_QUIC_CONFIG --> QUIC_CONNECTOR
end

subgraph subGraph0 ["Certificate Management"]
    CERT_MANAGER
    IDENTITY_STORE
    CONNECTION_TYPE
    SSL_CONTEXT_FACTORY
    CERT_MANAGER --> IDENTITY_STORE
    IDENTITY_STORE --> CONNECTION_TYPE
    CONNECTION_TYPE --> SSL_CONTEXT_FACTORY
end

subgraph subGraph1 ["HTTP/3 Integration"]
    H3_BIND_MANAGER
    CERT_LISTENER
    STORE_CHANGED
    RESTART_SERVER
    H3_BIND_MANAGER --> CERT_LISTENER
    CERT_LISTENER --> STORE_CHANGED
    STORE_CHANGED --> RESTART_SERVER
end
```

The certificate integration ensures that HTTP/3 connections use the same certificates as other Openfire services, maintaining consistent security across all protocols.

Sources: [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L414](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L414-L414)

 [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L937-L942](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L937-L942)

 [src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java L540-L569](https://github.com/igniterealtime/openfire-orinayo-plugin/blob/932fc61c/src/java/org/ifsoft/orinayo/openfire/Http3BindManager.java#L540-L569)